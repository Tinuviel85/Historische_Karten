<!DOCTYPE html>
<html>
<head>
    <title>Historische Kartenanwendung</title>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css"
    integrity="sha384-o/2yZuJZWGJ4s/adjxVW71R+EO/LyCwdQfP5UWSgX/w87iiTXuvDZaejd3TsN7mf" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"
    integrity="sha384-okbbMvvx/qfQkmiQKfd5VifbKZ/W8p1qIsWvE1ROPUfHWsDcC8/BnHohF7vPg2T6" crossorigin=""></script>
    <style type="text/css">
        body { margin: 0; padding: 0; }
        html, body, #map { width: 100%; height: 100%; }
        #menu { 
            margin: 10px; 
            position: absolute; 
            top: 10px; 
            left: 10px; 
            z-index: 1000; 
            background: white; 
            padding: 10px; 
            border-radius: 5px; 
        }
        #transparency1 { width: 100%; }
        #centerButton {
            margin-top: 10px;
            padding: 10px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div id="menu">
        <label for="transparency1">Transparenz der Karte:</label>
        <input type="range" id="transparency1" min="0" max="1" step="0.1" value="1">
        <button id="centerButton">Auf meine Position zentrieren</button>
    </div>
    <div id="map"></div>
    <script>
        // Initialisierung der Karte
        var map = L.map('map', {
            attributionControl: false
        }).setView([52.5200, 13.4050], 13); // Setzen Sie die initiale Ansicht auf das Zentrum von Berlin
        L.control.attribution({ prefix: false }).addTo(map);

        // Hinzufügen der Berlin 1925 Karte
        var historicalLayer = L.tileLayer('https://warper.wmflabs.org/maps/tile/191/{z}/{x}/{y}.png', {
            minZoom: 1,
            maxZoom: 19,
            tms: false,
            attribution: 'Historische Karte © [Ihr Name oder Quelle]'
        }).addTo(map);

        var transparencyControl = document.getElementById('transparency1');
        transparencyControl.addEventListener('input', function() {
            historicalLayer.setOpacity(this.value);
        });

        // GPS-Funktionalität
        var gpsMarker, gpsCircle;
        var currentPosition;

        function updateGPSPosition(position) {
            var lat = position.coords.latitude;
            var lng = position.coords.longitude;
            var accuracy = position.coords.accuracy;

            console.log("Position gefunden:", lat, lng, "Genauigkeit:", accuracy);
            currentPosition = [lat, lng];

            if (!gpsMarker) {
                gpsMarker = L.marker([lat, lng]).addTo(map)
                    .bindPopup("You are within " + accuracy + " meters from this point").openPopup();
            } else {
                gpsMarker.setLatLng([lat, lng]);
                gpsMarker.getPopup().setContent("You are within " + accuracy + " meters from this point");
            }

            if (!gpsCircle) {
                gpsCircle = L.circle([lat, lng], { radius: accuracy }).addTo(map);
            } else {
                gpsCircle.setLatLng([lat, lng]);
                gpsCircle.setRadius(accuracy);
            }
        }

        function handleError(error) {
            console.error('Geolocation Error:', error);
            alert('Geolocation Error: ' + error.message);
        }

        document.getElementById('centerButton').addEventListener('click', function() {
            if (currentPosition) {
                map.setView(currentPosition, 16); // Zentriert die Karte auf die aktuelle Position mit Zoomlevel 16
            } else {
                alert("Aktuelle Position nicht verfügbar.");
            }
        });

        if (navigator.geolocation) {
            navigator.geolocation.watchPosition(updateGPSPosition, handleError, {
                enableHighAccuracy: true,
                maximumAge: 10000,
                timeout: 5000
            });
        } else {
            console.log("Geolocation is not supported by this browser.");
            alert("Geolocation is not supported by this browser.");
        }
    </script>
</body>
</html>
